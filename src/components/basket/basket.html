<ion-grid class="basket">
    <ion-row class="actions-container">
        <ion-col>
            <ion-grid>
                <ion-row>
                    <ion-col col-md-2 offset-md-1>
                        <button ion-button clear (click)="selectOrCreateCustomer()" [disabled]="sale && sale.customerKey">
                        <ion-icon name="person-add"></ion-icon>
                        </button>
                    </ion-col>
                    <ion-col col-md-2 offset-md-1>
                        <button ion-button clear (click)="addNote()" [disabled]="!sale || (!sale.customerKey && sale.items.length == 0)">
                            <ion-icon name="paper"></ion-icon><span class="change-large" *ngIf="sale && sale.notes">*</span>
                        </button>
                    </ion-col>
                    <ion-col col-md-2 offset-md-1>
                        <button ion-button clear (click)="parkSale()" [disabled]="!sale || (!sale.customerKey && sale.items.length == 0)">
                            <ion-icon name="pause"></ion-icon>
                        </button>
                    </ion-col>
                    <ion-col col-md-2 offset-md-1>
                        <button ion-button clear (click)="discardSale()" [disabled]="!sale || (!sale.customerKey && sale.items.length == 0)">
                            <ion-icon name="trash"></ion-icon>
                        </button>
                    </ion-col>
                </ion-row>
            </ion-grid>
        </ion-col>
    </ion-row>
    <ion-row class="products-container">
        <ion-col>
            <ion-grid>
                <ion-row>
                    <ion-col>
                        <ion-list *ngIf="sale">
                        <ion-item [id]="item.purchsableItemId"
                                  *ngFor="let item of sale.items | groupBy:'employeeId'; let $index=index"
                                  [ngClass]="[item.cssClass && item.cssClass || '', item.isSelected && 'animated flash selected' || '']"
                                  tappable>
                            <ion-grid (click)="viewInfo(item, $index)">
                                <ion-row>
                                    <ion-col col-md-11 offset-md-1
                                             *ngIf="item.employeeId && employeesHash[item.employeeId] && (item.cssClass && (item.cssClass == 'group-item' || item.cssClass == 'group-item-start'))">
                                        <h1>{{employeesHash[item.employeeId].firstName}}</h1>
                                    </ion-col>
                                    <ion-col col-md-2>
                                        {{item.quantity}}
                                    </ion-col>
                                    <ion-col col-md-5 class="name">
                                        {{item.name}}
                                    </ion-col>
                                    <ion-col col-md-3 class="pull-right">
                                        <span>${{item.finalPrice * item.quantity | number : '1.2-2'}}</span>
                                        <br/>
                                        <span *ngIf="item.systemPrice != item.finalPrice">
                        <small>
                        <s>${{item.systemPrice * item.quantity | number : '1.2-2'}}</s>
                        </small>
                        </span>
                                    </ion-col>
                                    <ion-col col-md-1 class="seperator" >
                                        <span></span>
                                    </ion-col>
                                    <ion-col col-md-1 text-center="" (click)="removeItem($index)">
                                        <ion-icon name="trash" class="clickable"></ion-icon>
                                    </ion-col>
                                </ion-row>
                                <ion-row [id]="modifierItem.purchsableItemId" class="modifier-item" margin-left="10px"
                                         *ngFor="let modifierItem of item.modifierItems">
                                    <ion-col col-md-1 offset-md-1>
                                        {{modifierItem.quantity}}
                                    </ion-col>
                                    <ion-col col-md-5 class="name">
                                        {{modifierItem.name}}
                                    </ion-col>
                                    <ion-col col-md-3>
                                        <span>${{modifierItem.finalPrice * modifierItem.quantity | number : '1.2-2'}}</span>
                                        <br/>
                                        <span *ngIf="modifierItem.systemPrice != modifierItem.finalPrice">
                        <small>
                        <s>${{modifierItem.systemPrice * modifierItem.quantity | number : '1.2-2'}}</s>
                        </small>
                        </span>
                                    </ion-col>
                                </ion-row>
                            </ion-grid>
                        </ion-item>
                        </ion-list>
                    </ion-col>
                </ion-row>
            </ion-grid>
        </ion-col>
    </ion-row>
    <ion-row class="payment-container">
        <ion-col>
            <ion-grid *ngIf="sale">
                <ion-row>
                    <ion-col col-md-4 offset-md-3>Subtotal</ion-col>
                    <ion-col col-md-4>${{sale.subTotal | number : '1.2-2'}}</ion-col>
                </ion-row>
                <ion-row>
                    <ion-col col-md-4 offset-md-3 [ngPlural]="sale.items.length">
                        <ng-template ngPluralCase="=0">Tax</ng-template>
                        <ng-template ngPluralCase="=1">Tax
                            <small>({{sale.items[0].tax.name}})</small>
                        </ng-template>
                        <ng-template ngPluralCase="other">Tax
                            <small>({{sale.items.length}} taxes)</small>
                        </ng-template>
                    </ion-col>
                    <ion-col col-md-4>${{sale.tax | number : '1.2-2'}}</ion-col>
                </ion-row>
                <ion-row class="totalDiscount">
                    <ion-col col-md-4 offset-md-3 (click)="externalValue().applyDiscount()">{{ totalExternalValue > 0 ? "Total
                        Surcharge": "Total Discount" }}
                    </ion-col>
                    <ion-col col-md-4 >${{totalExternalValue | number : '1.2-2'}}
                    </ion-col>
                </ion-row>
                <ion-row>
                    <ion-col col-md-4 offset-md-3 [ngPlural]="sale.items.length" class="bold">
                        <ng-template ngPluralCase="=0">Total
                            <small>(no items)</small>
                        </ng-template>
                        <ng-template ngPluralCase="=1">Total
                            <small>(1 item)</small>
                        </ng-template>
                        <ng-template ngPluralCase="other">Total
                            <small>({{sale.items.length}} items)</small>
                        </ng-template>
                    </ion-col>
                    <ion-col col-md-4 class="bold">${{sale.taxTotal | number : '1.2-2'}}
                    </ion-col>
                </ion-row>
            </ion-grid>
        </ion-col>
    </ion-row>
    <ion-row *ngIf="sale">
        <ion-col col-md-6 no-padding>
            <button ion-button small block padding (click)="fastPayment()" class="pay-button"
                    color="warning" [disabled]="disablePaymentBtn">
                <span class="button-inner pull-left">
                <ion-icon name="flash"></ion-icon>
                </span>
            </button>
        </ion-col>
        <ion-col col-md-6 no-padding>
            <button ion-button small block padding (click)="gotoPayment()" class="pay-button"
                    [disabled]="disablePaymentBtn" [color]="sale.taxTotal >= 0 ? 'primary' : 'danger'">
                <span class="button-inner pull-right">
                {{ payBtnText }} &nbsp;&nbsp; ${{balance | number : '1.2-2'}}
                </span>
            </button>
        </ion-col>
    </ion-row>
</ion-grid>