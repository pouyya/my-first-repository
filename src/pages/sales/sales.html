<ion-header>
  <ion-navbar>
    <button ion-button menuToggle>
      <ion-icon name="menu"></ion-icon>
    </button>
    <ion-title style="text-Align:center">Sales</ion-title>
  </ion-navbar>
</ion-header>

<ion-content>
  <ion-grid class="full-height">
    <ion-row class="full-height">
      <ion-col col-2>
        <ion-list>
          <button ion-item *ngFor="let category of categories" class="text-wrap" [ngClass]="{'activeCategory': category._id == activeCategory._id }"
            (click)="itemSelected(category)">
              {{ category.name }}
          </button>
        </ion-list>
      </ion-col>
      <ion-col col-4>
        <tile-items [items]="activeTiles" (onSelect)="onSelect($event)">
        </tile-items>
      </ion-col>
      <ion-col col-6> <!-- *ngIf="invoice" -->
        <!-- Bucket [start]  -->
        <ion-grid class="top-component">
          <ion-row>
            <ion-col col-12>
              <ion-list>
                <!-- Items in the bucket [start] -->
                <ion-item *ngFor="let item of invoice.items; let $index=index" 
                [ngClass]="{active: isItemShown(item._id)}">

                  <ion-grid>
                    <ion-row>
                      <ion-col col-md-1>
                        {{item.quantity}}
                      </ion-col>
                      <ion-col col-md-2>
                        {{item.name}}
                      </ion-col>
                      <ion-col col-md-2>

                      </ion-col>
                      <ion-col col-md-2 offset-md-3 class="pull-right">
                        ${{item.quantity > 1 ? item.totalPrice : item.actualPrice | number : '1.2-2'}}
                      </ion-col>
                      <ion-col col-md-1 class="pull-right">
                        <ion-icon name="trash" class="clickable" (click)="removeItem(item, $index)"></ion-icon>
                      </ion-col>
                      <ion-col col-md-1 class="pull-right">
                        <ion-icon color="success" class="clickable"
                        (click)="toggleItem(item._id)"
                        [name]="isItemShown(item._id) ? 'arrow-dropdown' : 'arrow-dropright'">
                        </ion-icon>
                      </ion-col>
                    </ion-row>
                  </ion-grid>

                  <div *ngIf="isItemShown(item._id)">
                    <ion-grid>
                      <ion-row>

                        <!-- Quantity -->
                        <ion-col col-md-4>
                          <ion-item item-content>
                            <ion-label color="primary" stacked>Quantity</ion-label>
                            <ion-input type="number" min="1" 
                            [ngModel]="item.quantity"
                            (ngModelChange)="oldValue = item.quantity; aQ($event, item);"
                            ></ion-input>
                            <!-- (ngModelChange)="addQuantity($event, $index); oldValue = item.quantity;" -->
                          </ion-item>
                        </ion-col>

                        <!-- Price -->
                        <ion-col col-md-4>
                          <ion-item item-content>
                            <ion-label color="primary" stacked>Price</ion-label>
                            <ion-input type="text" [value]="item.quantity > 1 ? item.totalPrice : item.actualPrice" disabled></ion-input>
                          </ion-item>            
                        </ion-col>

                        <!-- Discount -->
                        <ion-col col-md-4>
                          <ion-item item-content>
                            <ion-label color="primary" stacked>Discount(%)</ion-label>
                            <ion-input type="number" [(ngModel)]="item.discount" min="0" max="99"
                            (change)="calculateDiscount(item)"></ion-input>
                          </ion-item>
                        </ion-col>

                        <ion-col col-md-12>
                          <ion-item item-content>
                            <ion-label color="primary" stacked>Notes</ion-label>
                            <ion-textarea 
                              [(ngModel)]="item.notes"
                              (change)="syncInvoice()"
                              placeholder="Type to add notes...">
                            </ion-textarea>
                          </ion-item>
                        </ion-col>

                      </ion-row>
                    </ion-grid>
                  </div>
                </ion-item>
                <!-- Items in the bucket [end] -->

              </ion-list>
            </ion-col>
          </ion-row>
        </ion-grid>
        <ion-grid class="bottom-component">
          <ion-row>
            <ion-col col-md-12>
              <hr/>
              <ion-textarea 
                [(ngModel)]="invoice.notes" 
                (change)="syncInvoice()" 
                placeholder="Add Sale Notes...">
              </ion-textarea>              
            </ion-col>
            <ion-col col-md-3>Discount</ion-col>
            <ion-col col-md-3 offset-md-6 class="pull-right">$0.00</ion-col>

            <ion-col col-md-3>Subtotal</ion-col>
            <ion-col col-md-3 offset-md-6 class="pull-right">${{invoice.subTotal | number : '1.2-2'}}</ion-col>

            <ion-col col-md-3>Tax (GST)</ion-col>
            <ion-col col-md-3 offset-md-6 class="pull-right">{{tax}}%</ion-col>

            <ion-col col-md-12><hr/></ion-col>
            <ion-col col-md-3>Total</ion-col>
            <ion-col col-md-3 offset-md-6 class="pull-right">${{invoice.taxTotal | number : '1.2-2'}}</ion-col>

            <ion-col col-12>
              <button ion-button secondary block padding>
                  <span class="button-inner pull-right" style="text-align: left">
                      Pay &nbsp;&nbsp; ${{invoice.taxTotal | number : '1.2-2'}}
                  </span>
              </button>
            </ion-col>
            
          </ion-row>
        </ion-grid>
        <!-- Bucket [end] -->
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>