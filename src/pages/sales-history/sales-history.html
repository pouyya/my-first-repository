<ion-header>
  <ion-navbar>
    <button ion-button menuToggle>
      <ion-icon name="menu"></ion-icon>
    </button>
    <ion-title style="text-Align:center">Sales History</ion-title>
  </ion-navbar>
</ion-header>

<ion-content>
  <ion-grid>
    <ion-row>
      <ion-col col-md-4>
        <p>Status</p>
        <ion-select [(ngModel)]="selectedStatus" (ionChange)="searchByStatus()">
          <ion-option *ngFor="let status of statusList" [value]="status.value">{{ status.text }}</ion-option>
        </ion-select>
      </ion-col>
      <ion-col col-md-4>
        <p>Customer</p>
        <ion-searchbar (ionInput)="searchBy($event, 'customerName')" [debounce]="1000" [animated]="true"></ion-searchbar>
      </ion-col>
      <ion-col col-md-4>
        <p>Receipt No#</p>
        <ion-searchbar (ionInput)="searchBy($event, 'receiptNo')" [debounce]="1000" [animated]="true"></ion-searchbar>
      </ion-col>
    </ion-row>
  </ion-grid>
  <ion-list>
    <ion-item>
      <ion-grid>
        <ion-row>
          <ion-col col-md-2><strong>Date</strong></ion-col>
          <ion-col col-md-1><strong>Receipt</strong></ion-col>
          <ion-col col-md-2><strong>Sold by</strong></ion-col>
          <ion-col col-md-2><strong>Customer</strong></ion-col>
          <ion-col col-md-2><strong>Note</strong></ion-col>
          <ion-col col-md-1><strong>Sale Total</strong></ion-col>
          <ion-col col-md-1><strong>Status</strong></ion-col>
          <ion-col col-md-1></ion-col>
        </ion-row>
      </ion-grid>
    </ion-item>
  </ion-list>
  <ion-list *ngIf="invoices.length > 0">
    <ion-item *ngFor="let invoice of invoices; let $index = index" [ngClass]="{active: isItemShown(invoice._id)}">
      <ion-grid>
        <ion-row (click)="toggleItem(invoice)">
          <ion-col col-md-2>{{invoice.created | date:'short'}}</ion-col>
          <ion-col col-md-1>{{invoice.receiptNo}}</ion-col>
          <ion-col col-md-2>-</ion-col>
          <ion-col col-md-2>{{invoice.customerName}}</ion-col>
          <ion-col col-md-2>{{invoice.notes}}</ion-col>
          <ion-col col-md-1>${{invoice.taxTotal}}</ion-col>
          <ion-col col-md-1>
            <strong>{{getState(invoice)}}</strong>
          </ion-col>
          <ion-col col-md-1 class="clickable">
            <ion-icon name="print" text-center *ngIf="invoice.state == 'completed'" (click)="printSale(invoice)"></ion-icon>
            <ion-icon name="refresh" text-center *ngIf="invoice.state == 'completed'" (click)="gotoSales(invoice, true, $index)"></ion-icon>
            <ion-icon name="share-alt" text-center *ngIf="invoice.state == 'parked'" (click)="gotoSales(invoice, false, $index)"></ion-icon>
          </ion-col>
        </ion-row>
      </ion-grid>
      <div *ngIf="isItemShown(invoice._id)">
        <hr/>
        <ion-grid *ngIf="!invoice.completed">
          <ion-row>
            <ion-col col-md-10>
              <ion-grid>
                <ion-row *ngFor="let item of invoice.items">
                  <ion-col col-md-5>
                    {{item.quantity}}&nbsp;&nbsp;{{item.name}}
                  </ion-col>
                  <ion-col col-md-5>
                    @ ${{item.actualPrice}}
                  </ion-col>
                  <ion-col col-md-2>
                    ${{item.finalPrice}}
                  </ion-col>
                </ion-row>
              </ion-grid>
            </ion-col>
            <ion-col col-md-2>
              <ion-item *ngIf="invoice.state === 'parked'" class="clickable" (click)="gotoSales(invoice, false, $index)">
                <ion-icon name="share-alt"></ion-icon> Continue Sale
              </ion-item>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col col-md-4>Note</ion-col>
            <ion-col col-md-4>
              SubTotal<br/> Total Tax (No Tax)
            </ion-col>
            <ion-col col-md-4>
              ${{invoice.taxTotal}}<br/> $0.00
            </ion-col>
          </ion-row>
        </ion-grid>

        <ion-grid *ngIf="invoice.completed">
          <ion-row>
            <ion-col col-md-10>
              <ion-grid>
                <ion-row *ngFor="let item of invoice.items">
                  <ion-col col-md-5>
                    {{item.quantity}}&nbsp;&nbsp;{{item.name}}
                  </ion-col>
                  <ion-col col-md-5>
                    @ ${{item.actualPrice}}
                  </ion-col>
                  <ion-col col-md-2>
                    ${{item.finalPrice}}
                  </ion-col>
                </ion-row>
              </ion-grid>
            </ion-col>
            <ion-col col-md-2>
              <ion-item *ngIf="invoice.state === 'completed'" class="clickable" (click)="gotoSales(invoice, true, $index)">
                <ion-icon name="refresh"></ion-icon> Return Items
              </ion-item>
              <ion-item *ngIf="invoice.state === 'completed'" class="clickable" (click)="printSale(invoice)">
                  <ion-icon name="print"></ion-icon> Print Invoice
                </ion-item>              
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col col-md-4>Note</ion-col>
            <ion-col col-md-4>
              SubTotal<br/> Total Tax (No Tax)
            </ion-col>
            <ion-col col-md-4>
              ${{invoice.taxTotal}}<br/> $0.00
            </ion-col>
          </ion-row>
        </ion-grid>
      </div>
    </ion-item>
  </ion-list>

  <ion-infinite-scroll (ionInfinite)="fetchMoreSales($event)">
    <ion-infinite-scroll-content></ion-infinite-scroll-content>
  </ion-infinite-scroll>

</ion-content>